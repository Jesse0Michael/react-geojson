(this["webpackJsonpreact-geojson"]=this["webpackJsonpreact-geojson"]||[]).push([[0],{28:function(e,t,n){e.exports=n(47)},35:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){},38:function(e,t,n){},39:function(e,t,n){},40:function(e,t,n){},42:function(e,t,n){},43:function(e,t,n){},47:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(14),c=n.n(r),i=n(11),l=n(3),s=n(25),u=n(18),m=(n(35),n(6)),d=n(51),p=n(12),g=n.n(p),f=n(13),v=(n(36),n(37),n(26));n(38);var b=function(e){var t=e.onLoad,n=e.onError,r=Object(a.useState)({drag:!1}),c=Object(m.a)(r,2),i=c[0],l=c[1],s=Object(a.useCallback)((function(e){l({drag:!1}),e.forEach((function(e){var a=new FileReader;a.onabort=function(){return n("file reading was aborted")},a.onerror=function(){return n("file reading has failed")},a.onload=function(){var e;try{e=JSON.parse(a.result)}catch(o){return void n("cannot parse geoJSON from file")}t(e)},a.readAsText(e)}))}),[t,n]),u=function(){l({drag:!0})},d=Object(v.a)({onDrop:s,noClick:!0}),p=d.getRootProps,g=d.getInputProps;return o.a.createElement("div",Object.assign({className:i.drag?"dropzone dropzone-drag":"dropzone"},p(),{onDragOver:function(e){return u()},onDragEnter:function(e){return u()},onDragLeave:function(e){l({drag:!1})}}),o.a.createElement("p",{style:{pointerEvents:"none"}},"Drag geo JSON files here, or click to select files"),o.a.createElement("input",Object.assign({className:"button"},g(),{style:{display:"block"}})))};g.a.accessToken="pk.eyJ1IjoiamVzc2UwbWljaGFlbCIsImEiOiJjazk5NDR0MDAweDB3M2Z0YW9ia2x4cjgxIn0._3heS1yvmszc0MIOphnH5g";function y(e){var t=e.entities.map((function(e){return{entityID:e.entityID,entityType:e.type}}));return{type:"Feature",properties:{id:e.id,entities:t,bounds:e.bounds,distance:e.distance,duration:e.duration,violations:e.violations},geometry:{type:"LineString",coordinates:e.path.map((function(e){return[e.lng,e.lat]}))}}}var O=function(){var e=Object(a.useState)({map:null,lng:-112,lat:33.5}),t=Object(m.a)(e,2),n=t[0],r=t[1];Object(a.useEffect)((function(){var e=new g.a.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[-112,33.5],zoom:9});e.on("move",(function(){r({map:e,lng:e.getCenter().lng.toFixed(4),lat:e.getCenter().lat.toFixed(4)})})),r({map:e,lng:e.getCenter().lng.toFixed(4),lat:e.getCenter().lat.toFixed(4)})}),[]);var c=Object(i.d)(),l=function(e){c.error(e);var t=document.getElementById("map");t.classList.add("shake"),setTimeout((function(){t.classList.remove("shake")}),1e3)};return o.a.createElement("div",null,o.a.createElement("div",{className:"sidebar"},o.a.createElement("div",null,"Longitude: ",n.lng," Latitude: ",n.lat," ")),o.a.createElement("div",{id:"map",className:"mapContainer"}),o.a.createElement(b,{onLoad:function(e){var t;try{t=Object(f.center)(e)}catch(c){var a=function(e){if(console.log(e),Array.isArray(e.data)){var t=e.data.map((function(e){return y(e)}));return console.log(t),{type:"FeatureCollection",features:t}}return y(e)}(e);try{t=Object(f.center)(a),e=a}catch(i){return void l("JSON is not valid geometry")}}var o=Object(d.a)();n.map.addSource(o,{type:"geojson",data:e}),n.map.addLayer({id:o,type:"line",source:o,layout:{},paint:{"line-color":"#088","line-opacity":.8,"line-width":3}});var r=new g.a.Popup({closeButton:!1,closeOnClick:!1,maxWidth:"480px"});n.map.on("mouseenter",o,(function(e){n.map.getCanvas().style.cursor="pointer";for(var t=Object(f.center)(e.features[0]).geometry.coordinates,a=e.features[0].properties,o="",c=0,i=Object.entries(a);c<i.length;c++){var l=Object(m.a)(i[c],2),s=l[0],u=l[1];o+="".concat(s,": ").concat(u,"<br />")}for(;Math.abs(e.lngLat.lng-t[0])>180;)t[0]+=e.lngLat.lng>t[0]?360:-360;r.setLngLat(t).setHTML(o).addTo(n.map)})),n.map.on("mouseleave",o,(function(){n.map.getCanvas().style.cursor="",r.remove()})),n.map.flyTo({center:t.geometry.coordinates,zoom:11,essential:!0})},onError:l}))},j=n(2),E=(n(39),n(40),n(27));n(42);function h(e){var t=Object(E.a)(),n=t.handleSubmit,a=t.register,r=t.errors;return o.a.createElement("form",{onSubmit:n((function(t){e.callback(t)})),className:"form"},o.a.createElement("label",null,"Websocket URL",o.a.createElement("input",{name:"url",ref:a,className:"url-input"})),r.url&&r.url.message,o.a.createElement("input",{type:"submit",value:"Submit",className:"button"}))}n(43);function k(e){var t=Object(a.useRef)(null);return Object(a.useEffect)((function(){t.current.scrollTop=t.current.scrollHeight}),[t,e]),o.a.createElement("textarea",{ref:t,className:"output-area",readOnly:!0,value:e.output.join("\n")})}g.a.accessToken="pk.eyJ1IjoiamVzc2UwbWljaGFlbCIsImEiOiJjazk5NDR0MDAweDB3M2Z0YW9ia2x4cjgxIn0._3heS1yvmszc0MIOphnH5g";var x=function(){var e=Object(a.useState)({map:null,lng:-112,lat:33.5}),t=Object(m.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)([]),l=Object(m.a)(c,2),s=l[0],u=l[1];Object(a.useEffect)((function(){var e=new g.a.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[-112,33.5],zoom:9});e.on("move",(function(){r({map:e,lng:e.getCenter().lng.toFixed(4),lat:e.getCenter().lat.toFixed(4)})})),r({map:e,lng:e.getCenter().lng.toFixed(4),lat:e.getCenter().lat.toFixed(4)})}),[]);var d=Object(i.d)(),p=function(e){d.error(e);var t=document.getElementById("map");t.classList.add("shake"),setTimeout((function(){t.classList.remove("shake")}),1e3)};return o.a.createElement("div",null,o.a.createElement(h,{callback:function(e){console.debug("connecting to",e.url);try{var t=new WebSocket(e.url);t.onopen=function(t){u([].concat(Object(j.a)(s),["opened connection to websocket server: ".concat(e.url)]))},t.onclose=function(e){u([].concat(Object(j.a)(s),["websocket connection closed"]))},t.onmessage=function(e){var t;try{t=JSON.parse(e.data)}catch(o){return void p("cannot parse geoJSON from realtime message")}var a=function(e){console.log(e);var t={deviceID:e.deviceID,accountID:e.accountID,altitude:e.altitude,heading:e.heading,latitude:e.latitude,longitude:e.longitude,velocity:e.velocity,timestamp:e.timestamp},n=[e.longitude,e.latitude];return{type:"Feature",properties:t,geometry:{type:"Point",coordinates:n}}}(t);!function(e,t){var a;try{a=Object(f.center)(t)}catch(c){return void p("invalid geojson data")}n.map.flyTo({center:a.geometry.coordinates,zoom:11,essential:!0});var o=n.map.getSource(e);if(o)o.setData(t);else{n.map.addSource(e,{type:"geojson",data:t}),n.map.addLayer({id:e,type:"circle",source:e,layout:{},paint:{"circle-stroke-color":"#088","circle-color":"#066","circle-stroke-opacity":.8,"circle-opacity":.6,"circle-stroke-width":3,"circle-radius":5}});var r=new g.a.Popup({closeButton:!1,closeOnClick:!1,maxWidth:"480px"});n.map.on("mouseenter",e,(function(e){n.map.getCanvas().style.cursor="pointer";for(var t=Object(f.center)(e.features[0]).geometry.coordinates,a=e.features[0].properties,o="",c=0,i=Object.entries(a);c<i.length;c++){var l=Object(m.a)(i[c],2),s=l[0],u=l[1];o+="".concat(s,": ").concat(u,"<br />")}for(;Math.abs(e.lngLat.lng-t[0])>180;)t[0]+=e.lngLat.lng>t[0]?360:-360;r.setLngLat(t).setHTML(o).addTo(n.map)})),n.map.on("mouseleave",e,(function(){n.map.getCanvas().style.cursor="",r.remove()}))}}(t.deviceID,a),u([].concat(Object(j.a)(s),[e.data]))},t.onerror=function(e){console.log(e),p("websocket error: ".concat(e))}}catch(a){p("failed to connect to websocket server: ".concat(e.url))}}}),o.a.createElement("div",{className:"sidebar"},o.a.createElement("div",null,"Longitude: ",n.lng," Latitude: ",n.lat," ")),o.a.createElement("div",{id:"map",className:"mapContainer"}),o.a.createElement(k,{output:s}))},L={position:i.b.BOTTOM_CENTER,timeout:5e3,offset:"30px",transition:i.c.FADE},C=function(){return o.a.createElement(i.a,Object.assign({template:u.a},L),o.a.createElement(O,null))},I=function(){return o.a.createElement(i.a,Object.assign({template:u.a},L),o.a.createElement(x,null))},w=function(){return o.a.createElement(l.c,null,o.a.createElement(l.a,{exact:!0,path:"/",component:C}),o.a.createElement(l.a,{exact:!0,path:"/websocket",component:I}))};c.a.render(o.a.createElement(s.a,null,o.a.createElement(w,null)),document.getElementById("root"))}},[[28,1,2]]]);
//# sourceMappingURL=main.3e68470b.chunk.js.map